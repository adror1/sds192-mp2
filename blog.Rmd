---
title: "Mini-Project 2"
authors: "Margaret Perry, Kendra Swanson, Arielle Dror"
date: "March 24, 2017"
output: html_document
---


##Goal
The goal of this code is to tidy and graph the data to display the corrolations between the cortributions and the success of the candidate. In the end we want three bar graphs displaying Tea party, Rep party, and Dem party with candidates on the x axis, contributions on the y axis, and colored according to whether each candidate won or lost.

To handle contributions for vs contributions against: stack bar graph. Use value to differentiate for or against, and color to differentiate winning or losing (eg. a candidate who won will have contributions represented as dark blue for contributions for and light blue for contributions against, and a candidate who lost will have contributions represented as dark green for contributions for and light green for contributions against.)

We're focusing just on general elections

```{r, include=FALSE}
library(tidyverse)
load("house_elections.rda")
load("candidates.rda")
load("committees.rda")
load("contributions.rda")
```

```{r}
library(dplyr)
library(tidyr)
```
##Tidying Data

```{r}
cmte_by_party <- function(party_arg) {
  committees %>%
    group_by(cmte_city) %>%
    filter(cmte_party_affiliation == party_arg) %>%
    select(cmte_name, cmte_dsgn, cmte_city, cmte_state, connected_org_name, cand_id)
}

democratic_cmte <- cmte_by_party("DEM")
republican_cmte <- cmte_by_party("REP")
teaparty_cmte <- cmte_by_party("TEA")


candidates_simple <- candidates %>%
  select(cand_id, cand_name, cand_party_affiliation, cand_office_state, cand_city)

```

```{r}
##Renaming columns for clarity and easier join
names(contributions)[names(contributions)=="name"] <- "cmte_name"

names(house_elections)[names(house_elections)=="candidate_name"] <- "cand_name"
house_elections <- house_elections %>%
  mutate(cand_name = toupper(cand_name))
```

```{r}
candidates_contributions <- contributions %>%
  full_join(candidates_simple, by = "cand_id")%>%
  select(cand_name, cand_party_affiliation, cmte_id, cmte_name, transaction_type, transaction_amt)
##head(candidates_contributions)

candidates_full <- house_elections %>%
  full_join(candidates_contributions, by = "cand_name", ignore.case = TRUE) %>%
  select(cand_name, cand_party_affiliation, cmte_id, cmte_name, transaction_type, transaction_amt, general_votes, ge_winner, state, district) %>%
  filter(!is.na(cand_party_affiliation), !is.na(ge_winner))

head(candidates_full, 20)
```
